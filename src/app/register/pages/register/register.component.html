<div class="section-container">
  <div class="register-header">
    <h1 class="tienda-title">{{ isUpdateMode() ? ('profile.update-title' | translate) : ('profile.create-title' | translate) }}</h1>
    <h2 class="tienda-subtitle">{{ isUpdateMode() ? ('profile.update-subtitle' | translate) :
      ('profile.create-subtitle' | translate) }}</h2>
  </div>

  <form [formGroup]="form" class="register-form">
    <!-- Secci贸n de Usuario -->
    <div class="form-section">
      <h2 class="section-title">{{ 'profile.user-data.title' | translate }}</h2>
      <div class="form-fields">
        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.name' | translate }}</mat-label>
          <input matInput type="text" [formControl]="form.controls.name" placeholder="Introduce tu nombre completo" />
          <mat-error *ngIf="form.controls.name.hasError('required') && form.controls.name.touched">
            El nombre es requerido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.phone' | translate }}</mat-label>
          <input matInput type="tel" [formControl]="form.controls.phone"
            placeholder="{{ 'profile.user-data.phone' | translate }}" />
          <mat-error *ngIf="form.controls.phone.hasError('required') && form.controls.phone.touched">
            {{ 'profile.user-data.phone-required' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.email' | translate }}</mat-label>
          <input matInput type="email" [formControl]="form.controls.email"
            placeholder="{{ 'profile.user-data.email' | translate }}" />
          <mat-error *ngIf="form.controls.email.hasError('required') && form.controls.email.touched">
            {{ 'profile.user-data.email-required' | translate }}
          </mat-error>
          <mat-error *ngIf="form.controls.email.hasError('email') && form.controls.email.touched">
            {{ 'profile.user-data.email-invalid' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.password' | translate }}</mat-label>
          <input matInput type="password" [formControl]="form.controls.password"
            placeholder="{{ 'profile.user-data.password' | translate }}" />
          <mat-error *ngIf="form.controls.password.hasError('required') && form.controls.password.touched">
            {{ 'profile.user-data.password-required' | translate }}
          </mat-error>
          <mat-error *ngIf="form.controls.password.hasError('minlength') && form.controls.password.touched">
            {{ 'profile.user-data.password-minlength' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.confirm-password' | translate }}</mat-label>
          <input matInput type="password" [formControl]="form.controls.confirmPassword"
            placeholder="{{ 'profile.user-data.confirm-password' | translate }}" />
          <mat-error
            *ngIf="form.controls.confirmPassword.hasError('required') && form.controls.confirmPassword.touched">
            {{ 'profile.user-data.confirm-password-required' | translate }}
          </mat-error>
          <mat-error
            *ngIf="form.hasError('passwordMismatch') && form.controls.confirmPassword.touched && !form.controls.confirmPassword.hasError('required')">
            {{ 'profile.user-data.password-mismatch' | translate }}
          </mat-error>
        </mat-form-field>

      </div>
    </div>

    <!-- Checkbox para activar secci贸n de artesano -->
    <div class="manufacturer-toggle">
      <mat-checkbox [formControl]="form.controls.isManufacturer">
        {{ 'profile.user-data.is-manufacturer' | translate }}
      </mat-checkbox>
    </div>

    <!-- Secci贸n de Artesano (opcional) -->
    <div class="form-section" *ngIf="isManufacturer">
      <h2 class="section-title">{{ 'profile.user-data.manufacturer-data' | translate }}</h2>
      <div class="form-fields">
        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.manufacturer-name' | translate }}</mat-label>
          <input matInput type="text" [formControl]="form.controls.manufacturerName"
            placeholder="{{ 'profile.user-data.manufacturer-name' | translate }}" />
          <mat-error
            *ngIf="form.controls.manufacturerName.hasError('required') && form.controls.manufacturerName.touched">
            {{ 'profile.user-data.manufacturer-name-required' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.manufacturer-phone' | translate }}</mat-label>
          <input matInput type="tel" [formControl]="form.controls.manufacturerPhone"
            placeholder="{{ 'profile.user-data.manufacturer-phone' | translate }}" />
          <mat-error
            *ngIf="form.controls.manufacturerPhone.hasError('required') && form.controls.manufacturerPhone.touched">
            {{ 'profile.user-data.phone-required' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.manufacturer-address' | translate }}</mat-label>
          <input matInput type="text" [formControl]="form.controls.manufacturerAddress"
            placeholder="Introduce la direcci贸n de tu negocio" />
          <mat-error
            *ngIf="form.controls.manufacturerAddress.hasError('required') && form.controls.manufacturerAddress.touched">
            {{ 'profile.user-data.manufacturer-address-required' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="tienda-f-width">
          <mat-label>{{ 'profile.user-data.manufacturer-description' | translate }}</mat-label>
          <textarea matInput [formControl]="form.controls.manufacturerDescription" placeholder="Describe tu negocio"
            rows="4"></textarea>
        </mat-form-field>

      </div>
      <ng-container *ngTemplateOutlet="imagesTemplate"></ng-container>
    </div>

    <div class="register-footer">
      <button type="button" class="tienda-primary-button" (click)="register()">
        {{ ('profile.user-data.save' | translate) }}
      </button>
    </div>
  </form>
</div>


<ng-template #imagesTemplate>
  <div class="images-container">
    <app-carrusel [showNavigation]="false" [showIndicators]="false" [images]="imageToDisplay() ? [imageToDisplay()!] : []"></app-carrusel>
    <div class="row">
      <label class="file-input-label">
        <input type="file" accept="image/*" #imageInput (change)="onFileSelected($event)" style="display: none;" />
        <button type="button" class="tienda-primary-button" (click)="imageInput.click()">
          {{ 'profile.user-data.change-image' | translate }}
        </button>
      </label>
    </div>
  </div>
</ng-template>